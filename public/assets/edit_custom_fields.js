(function(g){var j,k,h=[],l=window;g.fn.tinymce=function(q){var a=this,t,f,s,d,r,e="",c="";if(!a.length){return a}if(!q){return tinyMCE.get(a[0].id)}function b(){var m=[],n=0;if(i){i();i=null}a.each(function(y,x){var z,o=x.id,p=q.oninit;if(!o){x.id=o=tinymce.DOM.uniqueId()}z=new tinymce.Editor(o,q);m.push(z);if(p){z.onInit.add(function(){var u,v=p;if(++n==m.length){if(tinymce.is(v,"string")){u=(v.indexOf(".")===-1)?null:tinymce.resolve(v.replace(/\.\w+$/,""));v=tinymce.resolve(v)}v.apply(u||tinymce,m)}})}});g.each(m,function(o,p){p.render()})}if(!l.tinymce&&!k&&(t=q.script_url)){k=1;s=t.substring(0,t.lastIndexOf("/"));if(/_(src|dev)\.js/g.test(t)){c="_src"}d=t.lastIndexOf("?");if(d!=-1){e=t.substring(d+1)}l.tinyMCEPreInit=l.tinyMCEPreInit||{base:s,suffix:c,query:e};if(t.indexOf("gzip")!=-1){r=q.language||"en";t=t+(/\?/.test(t)?"&":"?")+"js=true&core=true&suffix="+escape(c)+"&themes="+escape(q.theme)+"&plugins="+escape(q.plugins)+"&languages="+r;if(!l.tinyMCE_GZ){tinyMCE_GZ={start:function(){tinymce.suffix=c;function m(n){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(n))}m("langs/"+r+".js");m("themes/"+q.theme+"/editor_template"+c+".js");m("themes/"+q.theme+"/langs/"+r+".js");g.each(q.plugins.split(","),function(n,o){if(o){m("plugins/"+o+"/editor_plugin"+c+".js");m("plugins/"+o+"/langs/"+r+".js")}})},end:function(){}}}}g.ajax({type:"GET",url:t,dataType:"script",cache:true,success:function(){tinymce.dom.Event.domLoaded=1;k=2;if(q.script_loaded){q.script_loaded()}b();g.each(h,function(n,m){m()})}})}else{if(k===1){h.push(b)}else{b()}}return a};g.extend(g.expr[":"],{tinymce:function(a){return a.id&&!!tinyMCE.get(a.id)}});function i(){function c(f){if(f==="remove"){this.each(function(r,q){var p=d(q);if(p){p.remove()}})}this.find("span.mceEditor,div.mceEditor").each(function(r,q){var p=tinyMCE.get(q.id.replace(/_parent$/,""));if(p){p.remove()}})}function a(p){var f=this,o;if(p!==j){c.call(f);f.each(function(n,m){var r;if(r=tinyMCE.get(m.id)){r.setContent(p)}})}else{if(f.length>0){if(o=tinyMCE.get(f[0].id)){return o.getContent()}}}}function d(f){var n=null;(f)&&(f.id)&&(l.tinymce)&&(n=tinyMCE.get(f.id));return n}function e(f){return !!((f)&&(f.length)&&(l.tinymce)&&(f.is(":tinymce")))}var b={};g.each(["text","html","val"],function(r,p){var q=b[p]=g.fn[p],f=(p==="text");g.fn[p]=function(m){var t=this;if(!e(t)){return q.apply(t,arguments)}if(m!==j){a.call(t.filter(":tinymce"),m);q.apply(t.not(":tinymce"),arguments);return t}else{var n="";var o=arguments;(f?t:t.eq(0)).each(function(w,s){var x=d(s);n+=x?(f?x.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):x.getContent()):q.apply(g(s),o)});return n}}});g.each(["append","prepend"],function(r,f){var q=b[f]=g.fn[f],p=(f==="prepend");g.fn[f]=function(m){var n=this;if(!e(n)){return q.apply(n,arguments)}if(m!==j){n.filter(":tinymce").each(function(u,o){var v=d(o);v&&v.setContent(p?m+v.getContent():v.getContent()+m)});q.apply(n.not(":tinymce"),arguments);return n}}});g.each(["remove","replaceWith","replaceAll","empty"],function(f,o){var p=b[o]=g.fn[o];g.fn[o]=function(){c.call(this,o);return p.apply(this,arguments)}});b.attr=g.fn.attr;g.fn.attr=function(v,s,u){var f=this;if((!v)||(v!=="value")||(!e(f))){return b.attr.call(f,v,s,u)}if(s!==j){a.call(f.filter(":tinymce"),s);b.attr.call(f.not(":tinymce"),v,s,u);return f}else{var t=f[0],r=d(t);return r?r.getContent():b.attr.call(g(t),v,s,u)}}}})(jQuery);if(!this.JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(A){var J,S,Q,K,d,w,I,N,z,D=0,H={},h=[],e=0,F={},y=[],f=null,m=new Image(),g=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,k=/[^\.]\.(swf)\s*$/i,q,L=1,a,c,O=false,C=20,t=A.extend(A("<div/>")[0],{prop:0}),j=0,R=!A.support.opacity&&!window.XMLHttpRequest,i=function(){S.hide();m.onerror=m.onload=null;if(f){f.abort()}J.empty()},p=function(){A.fancybox('<p id="fancybox_error">The requested content cannot be loaded.<br />Please try again later.</p>',{scrolling:"no",padding:20,transitionIn:"none",transitionOut:"none"})},E=function(){return[A(window).width(),A(window).height(),A(document).scrollLeft(),A(document).scrollTop()]},b=function(){var V=E(),ac={},aa=F.margin,W=F.autoScale,ab=(C+aa)*2,Z=(C+aa)*2,X=(F.padding*2),Y;if(F.width.toString().indexOf("%")>-1){ac.width=((V[0]*parseFloat(F.width))/100)-(C*2);W=false}else{ac.width=F.width+X}if(F.height.toString().indexOf("%")>-1){ac.height=((V[1]*parseFloat(F.height))/100)-(C*2);W=false}else{ac.height=F.height+X}if(W&&(ac.width>(V[0]-ab)||ac.height>(V[1]-Z))){if(H.type=="image"||H.type=="swf"){ab+=X;Z+=X;Y=Math.min(Math.min(V[0]-ab,F.width)/F.width,Math.min(V[1]-Z,F.height)/F.height);ac.width=Math.round(Y*(ac.width-X))+X;ac.height=Math.round(Y*(ac.height-X))+X}else{ac.width=Math.min(ac.width,(V[0]-ab));ac.height=Math.min(ac.height,(V[1]-Z))}}ac.top=V[3]+((V[1]-(ac.height+(C*2)))*0.5);ac.left=V[2]+((V[0]-(ac.width+(C*2)))*0.5);if(F.autoScale===false){ac.top=Math.max(V[3]+aa,ac.top);ac.left=Math.max(V[2]+aa,ac.left)}return ac},M=function(V){if(V&&V.length){switch(F.titlePosition){case"inside":return V;case"over":return'<span id="fancybox-title-over">'+V+"</span>";default:return'<span id="fancybox-title-wrap"><span id="fancybox-title-left"></span><span id="fancybox-title-main">'+V+'</span><span id="fancybox-title-right"></span></span>'}}return false},s=function(){var X=F.title,W=c.width-(F.padding*2),V="fancybox-title-"+F.titlePosition;A("#fancybox-title").remove();j=0;if(F.titleShow===false){return}X=A.isFunction(F.titleFormat)?F.titleFormat(X,y,e,F):M(X);if(!X||X===""){return}A('<div id="fancybox-title" class="'+V+'" />').css({width:W,paddingLeft:F.padding,paddingRight:F.padding}).html(X).appendTo("body");switch(F.titlePosition){case"inside":j=A("#fancybox-title").outerHeight(true)-F.padding;c.height+=j;break;case"over":A("#fancybox-title").css("bottom",F.padding);break;default:A("#fancybox-title").css("bottom",A("#fancybox-title").outerHeight(true)*-1);break}A("#fancybox-title").appendTo(d).hide()},o=function(){A(document).unbind("keydown.fb").bind("keydown.fb",function(V){if(V.keyCode==27&&F.enableEscapeButton){V.preventDefault();A.fancybox.close()}else{if(V.keyCode==37){V.preventDefault();A.fancybox.prev()}else{if(V.keyCode==39){V.preventDefault();A.fancybox.next()}}}});if(A.fn.mousewheel){K.unbind("mousewheel.fb");if(y.length>1){K.bind("mousewheel.fb",function(V,W){V.preventDefault();if(O||W===0){return}if(W>0){A.fancybox.prev()}else{A.fancybox.next()}})}}if(!F.showNavArrows){return}if((F.cyclic&&y.length>1)||e!==0){N.show()}if((F.cyclic&&y.length>1)||e!=(y.length-1)){z.show()}},T=function(){var V,W;if((y.length-1)>e){V=y[e+1].href;if(typeof V!=="undefined"&&V.match(g)){W=new Image();W.src=V}}if(e>0){V=y[e-1].href;if(typeof V!=="undefined"&&V.match(g)){W=new Image();W.src=V}}},v=function(){w.css("overflow",(F.scrolling=="auto"?(F.type=="image"||F.type=="iframe"||F.type=="swf"?"hidden":"auto"):(F.scrolling=="yes"?"auto":"visible")));if(!A.support.opacity){w.get(0).style.removeAttribute("filter");K.get(0).style.removeAttribute("filter")}A("#fancybox-title").show();if(F.hideOnContentClick){w.one("click",A.fancybox.close)}if(F.hideOnOverlayClick){Q.one("click",A.fancybox.close)}if(F.showCloseButton){I.show()}o();A(window).bind("resize.fb",A.fancybox.center);if(F.centerOnScroll){A(window).bind("scroll.fb",A.fancybox.center)}else{A(window).unbind("scroll.fb")}if(A.isFunction(F.onComplete)){F.onComplete(y,e,F)}O=false;T()},G=function(Z){var W=Math.round(a.width+(c.width-a.width)*Z),V=Math.round(a.height+(c.height-a.height)*Z),Y=Math.round(a.top+(c.top-a.top)*Z),X=Math.round(a.left+(c.left-a.left)*Z);K.css({width:W+"px",height:V+"px",top:Y+"px",left:X+"px"});W=Math.max(W-F.padding*2,0);V=Math.max(V-(F.padding*2+(j*Z)),0);w.css({width:W+"px",height:V+"px"});if(typeof c.opacity!=="undefined"){K.css("opacity",(Z<0.5?0.5:Z))}},x=function(V){var W=V.offset();W.top+=parseFloat(V.css("paddingTop"))||0;W.left+=parseFloat(V.css("paddingLeft"))||0;W.top+=parseFloat(V.css("border-top-width"))||0;W.left+=parseFloat(V.css("border-left-width"))||0;W.width=V.width();W.height=V.height();return W},U=function(){var Y=H.orig?A(H.orig):false,X={},W,V;if(Y&&Y.length){W=x(Y);X={width:(W.width+(F.padding*2)),height:(W.height+(F.padding*2)),top:(W.top-F.padding-C),left:(W.left-F.padding-C)}}else{V=E();X={width:1,height:1,top:V[3]+V[1]*0.5,left:V[2]+V[0]*0.5}}return X},u=function(){S.hide();if(K.is(":visible")&&A.isFunction(F.onCleanup)){if(F.onCleanup(y,e,F)===false){A.event.trigger("fancybox-cancel");O=false;return}}y=h;e=D;F=H;w.get(0).scrollTop=0;w.get(0).scrollLeft=0;if(F.overlayShow){if(R){A("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"})}Q.css({"background-color":F.overlayColor,opacity:F.overlayOpacity}).unbind().show()}c=b();s();if(K.is(":visible")){A(I.add(N).add(z)).hide();var W=K.position(),V;a={top:W.top,left:W.left,width:K.width(),height:K.height()};V=(a.width==c.width&&a.height==c.height);w.fadeOut(F.changeFade,function(){var X=function(){w.html(J.contents()).fadeIn(F.changeFade,v)};A.event.trigger("fancybox-change");w.empty().css("overflow","hidden");if(V){w.css({top:F.padding,left:F.padding,width:Math.max(c.width-(F.padding*2),1),height:Math.max(c.height-(F.padding*2)-j,1)});X()}else{w.css({top:F.padding,left:F.padding,width:Math.max(a.width-(F.padding*2),1),height:Math.max(a.height-(F.padding*2),1)});t.prop=0;A(t).animate({prop:1},{duration:F.changeSpeed,easing:F.easingChange,step:G,complete:X})}});return}K.css("opacity",1);if(F.transitionIn=="elastic"){a=U();w.css({top:F.padding,left:F.padding,width:Math.max(a.width-(F.padding*2),1),height:Math.max(a.height-(F.padding*2),1)}).html(J.contents());K.css(a).show();if(F.opacity){c.opacity=0}t.prop=0;A(t).animate({prop:1},{duration:F.speedIn,easing:F.easingIn,step:G,complete:v})}else{w.css({top:F.padding,left:F.padding,width:Math.max(c.width-(F.padding*2),1),height:Math.max(c.height-(F.padding*2)-j,1)}).html(J.contents());K.css(c).fadeIn(F.transitionIn=="none"?0:F.speedIn,v)}},r=function(){J.width(H.width);J.height(H.height);if(H.width=="auto"){H.width=J.width()}if(H.height=="auto"){H.height=J.height()}u()},P=function(){O=true;H.width=m.width;H.height=m.height;A("<img />").attr({id:"fancybox-img",src:m.src,alt:H.title}).appendTo(J);u()},l=function(){i();var aa=h[D],X,Y,ac,ab,W,V,Z;H=A.extend({},A.fn.fancybox.defaults,(typeof A(aa).data("fancybox")=="undefined"?H:A(aa).data("fancybox")));ac=aa.title||A(aa).title||H.title||"";if(aa.nodeName&&!H.orig){H.orig=A(aa).children("img:first").length?A(aa).children("img:first"):A(aa)}if(ac===""&&H.orig){ac=H.orig.attr("alt")}if(aa.nodeName&&(/^(?:javascript|#)/i).test(aa.href)){X=H.href||null}else{X=H.href||aa.href||null}if(H.type){Y=H.type;if(!X){X=H.content}}else{if(H.content){Y="html"}else{if(X){if(X.match(g)){Y="image"}else{if(X.match(k)){Y="swf"}else{if(A(aa).hasClass("iframe")){Y="iframe"}else{if(X.match(/#/)){aa=X.substr(X.indexOf("#"));Y=A(aa).length>0?"inline":"ajax"}else{Y="ajax"}}}}}else{Y="inline"}}}H.type=Y;H.href=X;H.title=ac;if(H.autoDimensions&&H.type!=="iframe"&&H.type!=="swf"){H.width="auto";H.height="auto"}if(H.modal){H.overlayShow=true;H.hideOnOverlayClick=false;H.hideOnContentClick=false;H.enableEscapeButton=false;H.showCloseButton=false}if(A.isFunction(H.onStart)){if(H.onStart(h,D,H)===false){O=false;return}}J.css("padding",(C+H.padding+H.margin));A(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){A(this).replaceWith(w.children())});switch(Y){case"html":J.html(H.content);r();break;case"inline":A('<div class="fancybox-inline-tmp" />').hide().insertBefore(A(aa)).bind("fancybox-cleanup",function(){A(this).replaceWith(w.children())}).bind("fancybox-cancel",function(){A(this).replaceWith(J.children())});A(aa).appendTo(J);r();break;case"image":O=false;A.fancybox.showActivity();m=new Image();m.onerror=function(){p()};m.onload=function(){m.onerror=null;m.onload=null;P()};m.src=X;break;case"swf":ab='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+H.width+'" height="'+H.height+'"><param name="movie" value="'+X+'"></param>';W="";A.each(H.swf,function(ad,ae){ab+='<param name="'+ad+'" value="'+ae+'"></param>';W+=" "+ad+'="'+ae+'"'});ab+='<embed src="'+X+'" type="application/x-shockwave-flash" width="'+H.width+'" height="'+H.height+'"'+W+"></embed></object>";J.html(ab);r();break;case"ajax":V=X.split("#",2);Z=H.ajax.data||{};if(V.length>1){X=V[0];if(typeof Z=="string"){Z+="&selector="+V[1]}else{Z.selector=V[1]}}O=false;A.fancybox.showActivity();f=A.ajax(A.extend(H.ajax,{url:X,data:Z,error:p,dataType:"html",success:function(ae,af,ad){if(f.status==200){J.html(ae);r()}}}));break;case"iframe":A('<iframe id="fancybox-frame" name="fancybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" scrolling="'+H.scrolling+'" src="'+H.href+'"></iframe>').appendTo(J);u();break}},n=function(){if(!S.is(":visible")){clearInterval(q);return}A("div",S).css("top",(L*-40)+"px");L=(L+1)%12},B=function(){if(A("#fancybox-wrap").length){return}A("body").append(J=A('<div id="fancybox-tmp"></div>'),S=A('<div id="fancybox-loading"><div></div></div>'),Q=A('<div id="fancybox-overlay"></div>'),K=A('<div id="fancybox-wrap"></div>'));if(!A.support.opacity){K.addClass("fancybox-ie");S.addClass("fancybox-ie")}d=A('<div id="fancybox-outer"></div>').append('<div class="fancy-bg" id="fancy-bg-n"></div><div class="fancy-bg" id="fancy-bg-ne"></div><div class="fancy-bg" id="fancy-bg-e"></div><div class="fancy-bg" id="fancy-bg-se"></div><div class="fancy-bg" id="fancy-bg-s"></div><div class="fancy-bg" id="fancy-bg-sw"></div><div class="fancy-bg" id="fancy-bg-w"></div><div class="fancy-bg" id="fancy-bg-nw"></div>').appendTo(K);d.append(w=A('<div id="fancybox-inner"></div>'),I=A('<a id="fancybox-close"></a>'),N=A('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),z=A('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));I.click(A.fancybox.close);S.click(A.fancybox.cancel);N.click(function(V){V.preventDefault();A.fancybox.prev()});z.click(function(V){V.preventDefault();A.fancybox.next()});if(R){Q.get(0).style.setExpression("height","document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + 'px'");S.get(0).style.setExpression("top","(-20 + (document.documentElement.clientHeight ? document.documentElement.clientHeight/2 : document.body.clientHeight/2 ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop )) + 'px'");d.prepend('<iframe id="fancybox-hide-sel-frame" src="javascript:\'\';" scrolling="no" frameborder="0" ></iframe>')}};A.fn.fancybox=function(V){A(this).data("fancybox",A.extend({},V,(A.metadata?A(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(X){X.preventDefault();if(O){return}O=true;A(this).blur();h=[];D=0;var W=A(this).attr("rel")||"";if(!W||W==""||W==="nofollow"){h.push(this)}else{h=A("a[rel="+W+"], area[rel="+W+"]");D=h.index(this)}l();return false});return this};A.fancybox=function(Y){if(O){return}O=true;var X=typeof arguments[1]!=="undefined"?arguments[1]:{};h=[];D=X.index||0;if(A.isArray(Y)){for(var W=0,V=Y.length;W<V;W++){if(typeof Y[W]=="object"){A(Y[W]).data("fancybox",A.extend({},X,Y[W]))}else{Y[W]=A({}).data("fancybox",A.extend({content:Y[W]},X))}}h=jQuery.merge(h,Y)}else{if(typeof Y=="object"){A(Y).data("fancybox",A.extend({},X,Y))}else{Y=A({}).data("fancybox",A.extend({content:Y},X))}h.push(Y)}if(D>h.length||D<0){D=0}l()};A.fancybox.showActivity=function(){clearInterval(q);S.show();q=setInterval(n,66)};A.fancybox.hideActivity=function(){S.hide()};A.fancybox.next=function(){return A.fancybox.pos(e+1)};A.fancybox.prev=function(){return A.fancybox.pos(e-1)};A.fancybox.pos=function(V){if(O){return}V=parseInt(V,10);if(V>-1&&y.length>V){D=V;l()}if(F.cyclic&&y.length>1&&V<0){D=y.length-1;l()}if(F.cyclic&&y.length>1&&V>=y.length){D=0;l()}return};A.fancybox.cancel=function(){if(O){return}O=true;A.event.trigger("fancybox-cancel");i();if(H&&A.isFunction(H.onCancel)){H.onCancel(h,D,H)}O=false};A.fancybox.close=function(){if(O||K.is(":hidden")){return}O=true;if(F&&A.isFunction(F.onCleanup)){if(F.onCleanup(y,e,F)===false){O=false;return}}i();A(I.add(N).add(z)).hide();A("#fancybox-title").remove();K.add(w).add(Q).unbind();A(window).unbind("resize.fb scroll.fb");A(document).unbind("keydown.fb");function V(){Q.fadeOut("fast");K.hide();A.event.trigger("fancybox-cleanup");w.empty();if(A.isFunction(F.onClosed)){F.onClosed(y,e,F)}y=H=[];e=D=0;F=H={};O=false}w.css("overflow","hidden");if(F.transitionOut=="elastic"){a=U();var W=K.position();c={top:W.top,left:W.left,width:K.width(),height:K.height()};if(F.opacity){c.opacity=1}t.prop=1;A(t).animate({prop:0},{duration:F.speedOut,easing:F.easingOut,step:G,complete:V})}else{K.fadeOut(F.transitionOut=="none"?0:F.speedOut,V)}};A.fancybox.resize=function(){var W,V;if(O||K.is(":hidden")){return}O=true;W=w.wrapInner("<div style='overflow:auto'></div>").children();V=W.height();K.css({height:V+(F.padding*2)+j});w.css({height:V});W.replaceWith(W.children());A.fancybox.center()};A.fancybox.center=function(){O=true;var V=E(),W=F.margin,X={};X.top=V[3]+((V[1]-((K.height()-j)+(C*2)))*0.5);X.left=V[2]+((V[0]-(K.width()+(C*2)))*0.5);X.top=Math.max(V[3]+W,X.top);X.left=Math.max(V[2]+W,X.left);K.css(X);O=false};A.fn.fancybox.defaults={padding:10,margin:20,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.3,overlayColor:"#666",titleShow:true,titlePosition:"outside",titleFormat:null,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,onStart:null,onCancel:null,onComplete:null,onCleanup:null,onClosed:null};A(document).ready(function(){B()})})(jQuery);var Mustache=function(){var a=function(){};a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(e,d,c,f){if(!f){this.context=d;this.buffer=[]}if(!this.includes("",e)){if(f){return e}else{this.send(e);return}}e=this.render_pragmas(e);var b=this.render_section(e,d,c);if(f){return this.render_tags(b,d,c,f)}this.render_tags(b,d,c,f)},send:function(b){if(b!=""){this.buffer.push(b)}},render_pragmas:function(b){if(!this.includes("%",b)){return b}var d=this;var c=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return b.replace(c,function(g,e,f){if(!d.pragmas_implemented[e]){throw ({message:"This implementation of mustache doesn't understand the '"+e+"' pragma"})}d.pragmas[e]={};if(f){var h=f.split("=");d.pragmas[e][h[0]]=h[1]}return""})},render_partial:function(b,d,c){b=this.trim(b);if(!c||c[b]===undefined){throw ({message:"unknown_partial '"+b+"'"})}if(typeof(d[b])!="object"){return this.render(c[b],d,c,true)}return this.render(c[b],d[b],c,true)},render_section:function(d,c,b){if(!this.includes("#",d)&&!this.includes("^",d)){return d}var f=this;var e=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return d.replace(e,function(h,i,g,j){var k=f.find(g,c);if(i=="^"){if(!k||f.is_array(k)&&k.length===0){return f.render(j,c,b,true)}else{return""}}else{if(i=="#"){if(f.is_array(k)){return f.map(k,function(l){return f.render(j,f.create_context(l),b,true)}).join("")}else{if(f.is_object(k)){return f.render(j,f.create_context(k),b,true)}else{if(typeof k==="function"){return k.call(c,j,function(l){return f.render(l,c,b,true)})}else{if(k){return f.render(j,c,b,true)}else{return""}}}}}}})},render_tags:function(k,b,d,f){var e=this;var j=function(){return new RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")};var g=j();var h=function(n,i,m){switch(i){case"!":return"";case"=":e.set_delimiters(m);g=j();return"";case">":return e.render_partial(m,b,d);case"{":return e.find(m,b);default:return e.escape(e.find(m,b))}};var l=k.split("\n");for(var c=0;c<l.length;c++){l[c]=l[c].replace(g,h,this);if(!f){this.send(l[c])}}if(f){return l.join("\n")}},set_delimiters:function(c){var b=c.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(c){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,e){c=this.trim(c);function b(h){return h===false||h===0||h}var f=e;var g=c.split(/\./);for(var d=0;d<g.length;d++){c=g[d];if(f&&b(f[c])){f=f[c]}else{if(d==0&&b(this.context[c])){f=this.context[c]}else{f=undefined}}}if(typeof f==="function"){return f.apply(e)}if(f!==undefined){return f}return""},includes:function(c,b){return b.indexOf(this.otag+c)!=-1},escape:function(b){b=String(b===null?"":b);return b.replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return c}})},create_context:function(c){if(this.is_object(c)){return c}else{var d=".";if(this.pragmas["IMPLICIT-ITERATOR"]){d=this.pragmas["IMPLICIT-ITERATOR"].iterator}var b={};b[d]=c;return b}},is_object:function(b){return b&&typeof b=="object"},is_array:function(b){return Object.prototype.toString.call(b)==="[object Array]"},trim:function(b){return b.replace(/^\s*|\s*$/g,"")},map:function(f,d){if(typeof f.map=="function"){return f.map(d)}else{var e=[];var b=f.length;for(var c=0;c<b;c++){e.push(d(f[c]))}return e}}};return({name:"mustache.js",version:"0.3.1-dev",to_html:function(d,b,c,f){var e=new a();if(f){e.send=f}e.render(d,b,c);if(!f){return e.buffer.join("\n")}}})}();$(document).ready(function(){$("button.edit-categories-link").click(function(){var a=$(this);$.fancybox({titleShow:false,href:a.attr("data-url"),padding:0,onComplete:function(){SetupCustomFieldCategoryEditor(a.prev())},onCleanup:function(){}})})});var SetupCustomFieldCategoryEditor=function(l){var b=$("#edit-custom-field-category");var c=b.find("form.formtastic");var g=b.find(".popup-actions button");var m=b.find("ol");var n=$("#category-tmpl").html();var h=$("#category-tmpl").attr("data-base-input-name");var i=categories;var k=0;var j=function(){$.each(m.find("li.added:visible input[data-field=position]"),function(q){$(this).val(q)})};var p=function(t){if(t.error==null){m=t.category_items.sort(function(v,u){return(v.position-u.position)});var q="";var s=l.val();for(var r=0;r<m.length;r++){q+='<option value="'+m[r].id+'" >'+m[r].name+"</option>"}l.html(q);l.val(s);$.fancybox.close()}else{$.growl("error",t.error)}};var a=function(q){$.ajax({type:"PUT",dataType:"json",data:c.serialize(),url:c.attr("action"),success:p});q.preventDefault();q.stopPropagation()};var e=function(q){var r=q.find("input[data-field=name]");q.find("button").bind("click",function(t){var s=$.extend({},i.template);s.name=r.val().trim();if(s.name==""){return false}o(s,{refreshPosition:true});r.val("").focus();t.preventDefault();t.stopPropagation()});r.keypress(function(s){if(s.which==13){q.find("button").trigger("click");s.preventDefault()}})};var d=function(q,r){r.find("a.remove").click(function(s){if(confirm($(this).attr("data-confirm"))){if(q.new_record){r.remove()}else{r.hide().find("input[data-field=_destroy]").val(1)}j();$.fancybox.resize()}s.preventDefault();s.stopPropagation()})};var o=function(s,q){q=$.extend({is_template:false,refreshPosition:false},q);s=$.extend({behaviour_flag:function(){return q.is_template?"template":"added"},new_record_flag:function(){return this.new_record==true&&q.is_template==false?"new":""},errors_flag:function(){return this.errors&&Object.size(this.errors)>0?"error":""},base_name:function(){return q.is_template?"":h+"["+k+"]"},base_dom_id:function(){return q.is_template?"category_template":"category_"+k},if_existing_record:function(){return this.new_record==false}},s);var r=Mustache.to_html(n,s);if(q.is_template){domField=m.append(r).find(".template");e(domField)}else{domField=m.find("> .template").before(r).prev("li");d(s,domField);m.sortable("refresh");if(q.refreshPosition){j()}k++}$.fancybox.resize()};var f=function(){m.sortable({handle:"span.handle",items:"li:not(.template)",axis:"y",update:j});o(i.template,{is_template:true});for(var q=0;q<i.collection.length;q++){o(i.collection[q])}g.click(a)};f()};$(document).ready(function(){$(".has-many-selector").hasManySelector()});(function($){$.fn.hasManySelector=function(options){var populateSelect=function(context){context.select.find("optgroup, option").remove();if(context.data.new_item){var newItemInfo=context.data.new_item;var option=makeOption(newItemInfo.label,newItemInfo.url,true,true);context.select.append(option);context.select.append(makeOption("-".repeat(newItemInfo.label.length),"",false,false))}for(var i=0;i<context.data.collection.length;i++){var obj=context.data.collection[i];if(typeof(obj.name)!="undefined"){var optgroup=$("<optgroup/>").attr("label",obj.name);var size=0;for(var j=0;j<obj.items.length;j++){var innerObj=obj.items[j];if($.inArray(innerObj[1],context.data.taken_ids)==-1){optgroup.append(makeOption(innerObj[0],innerObj[1],false,false));size++}}if(size>0){context.select.append(optgroup)}}else{if($.inArray(obj[1],context.data.taken_ids)==-1){var option=makeOption(obj[0],obj[1],false,false);context.select.append(option)}}}if(context.select.find("option").size()==0){context.list.find("li.template").hide()}else{context.list.find("li.template").show()}};var addId=function(context,id){context.data.taken_ids.push(id);populateSelect(context);if(context.data.taken_ids.length>0){context.empty.hide();context.list.next("input[type=hidden]").remove()}if(context.data.taken_ids.length==context.data.collection.length){context.sep.hide()}};var removeId=function(context,id){context.data.taken_ids=jQuery.grep(context.data.taken_ids,function(value){return value!=id});populateSelect(context);if(context.data.taken_ids.length==0){context.empty.show();context.list.after('<input type="hidden" name="'+context.baseInputName+'" value="" />')}context.sep.show()};var registerElementEvents=function(context,data,domElement){domElement.find("a.edit").click(function(e){var url=context.data.edit_item_url.replace(/\/42\//,"/"+data.id+"/");window.location.href=url;e.preventDefault();e.stopPropagation()});domElement.find("a.remove").click(function(e){domElement.remove();removeId(context,data.id);context.list.sortable("refresh");e.preventDefault();e.stopPropagation()})};var registerElementTemplateEvents=function(context,domElement){domElement.find("button").click(function(e){var newElement={id:context.select.val(),label:context.select.find("option:selected").text()};if(newElement.id==""){return}if(newElement.id.match(/^http:\/\//)){window.location.href=newElement.id;e.preventDefault();e.stopPropagation();return}addId(context,newElement.id);addElement(context,newElement,{refreshPosition:true});context.list.sortable("refresh");e.preventDefault();e.stopPropagation()})};var addElement=function(context,data,options){options=$.extend({is_template:false,refreshPosition:false},options);data=$.extend({behaviour_flag:function(){return options.is_template?"template":"added"},base_name:function(){return options.is_template?"":context.baseInputName},if_template:function(){return options.is_template}},data);var html=Mustache.to_html(context.template,data);var domElement=null;if(options.is_template){domElement=context.list.append('<li class="sep">&nbsp;</li>').append(html).find(".template");context.sep=context.list.find(".sep");registerElementTemplateEvents(context,domElement)}else{domElement=context.list.find("> .sep").before(html).prev("li");registerElementEvents(context,data,domElement);context.error.hide();context.list.sortable("refresh")}};return this.each(function(){var wrapper=$(this);var context={list:wrapper.find("ul"),empty:wrapper.find("p:first"),template:wrapper.find("script[name=template]").html(),baseInputName:wrapper.find("script[name=template]").attr("data-base-input-name"),data:eval(wrapper.find("script[name=data]").html()),error:wrapper.parent().find("p.inline-errors")};context.list.sortable({handle:"span.handle",items:"li:not(.template)",axis:"y"});addElement(context,null,{is_template:true});context.select=wrapper.find("select[name=label]");populateSelect(context);for(var i=0;i<context.data.taken_ids.length;i++){var data={id:context.data.taken_ids[i],label:null};for(var j=0;j<context.data.collection.length;j++){var current=context.data.collection[j];if(typeof(current.name)=="undefined"){if(data.id==current[1]){data.label=current[0];break}}else{for(var k=0;k<current.items.length;k++){var localCurrent=current.items[k];if(data.id==localCurrent[1]){data.label=localCurrent[0];break}}}}addElement(context,data)}if(context.error.size()>0){context.error.show()}})}})(jQuery);